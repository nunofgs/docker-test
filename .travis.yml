before_install:
  - curl -sf https://test.docker.com | sh
  # - mkdir ~/.docker && echo '{ "experimental":"enabled" }' > ~/.docker/config.json
  - docker --version

dist: bionic

language: bash

env:
  global:
    - DOCKER_CLI_EXPERIMENTAL=enabled
  matrix:
    - VARIANT=alpine
    - VARIANT=debian

stages:
  - name: push
    if: tag IS present OR branch = master

script:
  - docker login -u=nunofgs -p="$DOCKER_PASSWORD"
  - docker run --privileged linuxkit/binfmt:v0.7
  - docker buildx create --use
  - docker buildx build --platform linux/amd64,linux/arm/v6,linux/arm/v7,linux/arm64 --build-arg "version=$TRAVIS_BRANCH" -t nunofgs/test:latest -f "$VARIANT/Dockerfile" .
